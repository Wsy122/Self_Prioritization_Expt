---
title: "采用贝叶斯序列分析确定样本量"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
documentclass: ctexart
output:
  html_document:
    fig_caption: true
    number_sections: true
    toc: true
  pdf_document:
    toc: true
geometry: left=2cm,right=2cm,top=2cm,bottom=2cm
editor_options:
  markdown:
    wrap: 72
---

-   停止规则：
    -   贝叶斯因子阈值确定为10
    -   最小样本量40，最大样本量70
-   研究假设
    -   匹配任务
        -   关联类型的主效应
        -   关联类型与难度的交互作用
    -   辨别任务
        -   关联类型的主效应
        -   关联类型与难度的交互作用
    -   任务间的比较
        -   任务类型的主效应
        -   任务类型与难度的交互作用

```{r}
rm(list = ls())
```

下载和安装需要的R语言程序包

```{r message=FALSE, warning=FALSE}
# install.packages(c("tidyverse", "BayesFactor", "here"))
library(BayesFactor)#计算t检验和方差分析的贝叶斯因子
library(tidyverse)
library(showtext)#解决中文字体无法显示问题
library(latex2exp)#latex语法
# font_add("song", 
         # "/System/Library/Fonts/Supplemental/Songti.ttc")
##从系统增加宋体字
showtext_auto()
library(here)
here()
options(scipen = 9)#将科学计数法改为在万后9位
set.seed(1234)
```

BayesFacotr包版本

```{r}
packageVersion("BayesFactor")
```

## 数据预处理

**读取目录下的原始数据**

```{r}
# 文件路径和文件名根据实际情况调整
# 设置目标文件夹相对路径
folder_path <- "../2_1_2_RawData/pilot_expt_all"

# 列出所有含有"pilot_expt_v4_"的csv文件
file_list <- list.files(
  path = folder_path,
  pattern = "*pilot_expt_0421_.*\\.csv$", full.names = TRUE
)

# 创建一个空列表来存储数据
df_list_1 <- list()

# 逐个读取文件并存储
for (file in file_list) {
  file_name <- tools::file_path_sans_ext(basename(file))  # 获取文件名（不带扩展名）
  df_list_1[[file_name]] <- read.csv(file)  # 将数据存储在列表中
}
#rm(file, file_list, folder_path)
```

**数据清洗**

```{r}
# 创建输出文件夹（如果不存在）
output_path <- "../2_1_3_CleanData/pilot_expt_all"
if (!dir.exists(output_path)) {
  dir.create(output_path, recursive = TRUE)
}

# 逐篇处理每个数据框
for (file_name in names(df_list_1)) {
  data <- df_list_1[[file_name]]

  # 提取被试信息
  participant_info <- data[data$part == "survey", "response"]
  participant_info <- gsub("[{}\"]", "", participant_info) # 去掉多余的字符
  info_list <- strsplit(participant_info, ",")[[1]]

  # 创建新的变量
  participant_data <- data.frame(
    subj_idx = file_name,
    Sex = as.character(NA),
    Age = as.numeric(NA),
    Handedness = as.character(NA),
    Color_blindness = as.character(NA),
    stringsAsFactors = FALSE
  )
  
  # 先按照下划线分割字符串
  split_data <- strsplit(participant_data$subj_idx, "_")
  # 提取分割后的第四个元素（数字部分在第四个位置，可根据实际调整）并转换为数值
  participant_data$subj_idx <- as.numeric(lapply(split_data, function(x) substr(x[[4]], 1, 2)))

  for (info in info_list) {
    key_value <- strsplit(info, ":")[[1]]
    key <- trimws(key_value[1])
    value <- trimws(key_value[2])
    if (key == "sex") participant_data$Sex <- value
    if (key == "age") participant_data$Age <- as.numeric(value)
    if (key == "hands") participant_data$Handedness <- value
    if (key == "color_blindness") participant_data$Color_blindness <- value
  }

  # 提取行为数据
  behavior_data <- data[
    data$part %in% c("motion_test","match_RDK","RDK"),
    c(
      "part", "rt", "response", "correct", "coherent_direction","coherence",
      "isMatch", "association", "difficulty", "dot_color_final","target_color_proportion"
    )
  ]
  
  # 分别提取正式试次
  official_trials <- do.call(
    rbind,
    lapply(unique(behavior_data$part), function(part) {
      part_data <- behavior_data[behavior_data$part == part, ]
      if (part == "match_RDK") {
        return(tail(part_data, 384)) # 匹配任务384次
      } else if (part == "RDK") {
        return(tail(part_data, 192)) # 辨别任务192次
      } else {
        return(NULL)
      }
    })
  )

  # 合并被试信息和行为数据
  final_data <- cbind(participant_data, official_trials)

  # 输出到新的CSV文件
  output_file <- file.path(output_path, paste0(file_name, "_Clean.csv"))
  write.csv(final_data, output_file, row.names = FALSE)
}
```

**读取清洗后的数据**

```{r message=FALSE}
# 设置目标文件夹相对路径
folder_path <- "../2_1_3_CleanData/pilot_expt_all"

# 列出所有含有"pilot_expt_"的csv文件
file_list <- list.files(
  path = folder_path,
  pattern = "*pilot_expt_0421_.*\\.csv$", full.names = TRUE
)

# 创建一个空列表来存储数据
df_list_1 <- list()

# 逐个读取文件并存储
for (file in file_list) {
  file_name <- tools::file_path_sans_ext(basename(file)) # 获取文件名（不带扩展名）
  df_list_1[[file_name]] <- read.csv(file) # 将数据存储在列表中
}

# 清除不需要的变量
rm(output_path, participant_info, info_list, participant_data, split_data,
   behavior_data, official_trials, final_data, output_file, file, file_list,
   file_name, folder_path, info, key, key_value, value)

# 把 df_list_1 传送给 data
data <- do.call(rbind, df_list_1)
```

定义函数，用来计算平均反应时、正确率和自我-他人差异(SPE)

```{r}
# 计算平均正确率和反应时
copmute_rt_acc <- function(data){
  data <- data %>%
  dplyr::filter(part %in% c("match_RDK","RDK")) %>%
    dplyr::group_by(subj_idx, part, difficulty, association, isMatch) %>% # 按被试与难度和关联类型分组
    dplyr::summarise(
      rt = mean(rt, na.rm = TRUE),#每个被试所有trial的平均反应时
      # rt_max = max(rt, na.rm = TRUE),#每个被试所有trial的最大反应时
      # rt_min = min(rt, na.rm = TRUE),#每个被试所有trial的最小反应时
      # sd_rt = sd(rt, na.rm = TRUE), #每个被试所有trial的反应时的方差
      # all_count = n(),#每个被试在每个条件的总trial数量
      # row_count = sum(rt >= 200 & rt <= 3000, na.rm = TRUE), #舍弃按键太快和按键太慢的反应时
      # correct_count = sum(correct == 'true' & rt >= 200 & rt <= 3000, na.rm = TRUE),
      acc = sum(correct == 'true' & rt >= 200 & rt <= 3000, na.rm = TRUE) / n(), #计算每个被试在每个条件的正确率= 正确/总数
      .groups = "drop")
   
    # 返回处理后的数据
    return(data)
}

# 计算自我-他人差异，即自我减去他人
compute_diff <- function(data, keepMatch=FALSE){
  # 决定分组变量
  group_vars <- if(keepMatch) {
    c("subj_idx", "part", "difficulty", "isMatch")
  } else {
    c("subj_idx", "part", "difficulty")
  }
  
  # 执行数据处理流程
  data_agg <- data %>%
    dplyr::filter(part %in% c("match_RDK","RDK")) %>%
    dplyr::group_by_at(group_vars) %>%  # 使用 group_by_at 接受变量名向量
    dplyr::summarise(
      rt_other = mean(rt[association == "other"], na.rm = TRUE),
      rt_self = mean(rt[association == "self"], na.rm = TRUE),
      acc_other = mean(acc[association == "other"], na.rm = TRUE),
      acc_self = mean(acc[association == "self"], na.rm = TRUE),
      .groups = "drop"
    )
  
  # 计算差值
  data_result <- data_agg %>%
    dplyr::mutate(
      rt_diff_os = rt_other - rt_self, # 反应时越快越好，他人-自我 > 0 为自我优势
      acc_diff_so = acc_self - acc_other # 正确率越高越好，自我-他人 > 0 为自我优势
    )
  
  return(data_result)
}
```

```{r}
# 创建输出文件夹（如果不存在）
output_path <- "../2_1_3_CleanData/pilot_expt_all"
if (!base::dir.exists(output_path)) {
  base::dir.create(output_path, recursive = TRUE)
}

data <- data %>%
  #筛出反应时在200~3000)
  dplyr::filter(rt >= 200 & rt <= 3000)

# Motion
data1 <- data %>%
  dplyr::filter(
    subj_idx %in% c( seq(1, 20))) # 被试编号 1-20 为运动组
              
data_motion_rt_acc <- copmute_rt_acc(data1) %>%
  dplyr::mutate(group = "motion") # %>%
  # tidyr::pivot_wider(names_from = c(part, difficulty, association), 
              #values_from = c(rt, acc))

data_motion_diff <- compute_diff(data_motion_rt_acc) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty))

# Color
data2 <- data %>%
  dplyr::filter(
    subj_idx %in% c( seq(21, 40))) # 后20为颜色

data_color_rt_acc <- copmute_rt_acc(data2) %>%
  dplyr::mutate(group = "color")

data_color_diff <- compute_diff(data_color_rt_acc) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty))

data_color_diff_keepMatch <- compute_diff(data_color_rt_acc, TRUE) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty))
```

## 数据整理

### 运动组-匹配任务

```{r}
df_motion_match <- data_motion_rt_acc %>% 
  dplyr::filter(# difficulty %in% c(1, 4), 
    part %in% c('match_RDK')) %>%
  dplyr::select(subj_idx, acc, rt, association, difficulty, isMatch, group) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         association = as.factor(association),
         difficulty = as.factor(difficulty))

# 输出到新的CSV文件
  output_file <- base::file.path(output_path, "df_motion_match.csv")
  utils::write.csv(df_motion_match, output_file, row.names = FALSE)

df_motion_diff_match <- data_motion_diff %>%
  # 只选择难度为1 和 4 的
  dplyr::filter(# difficulty %in% c(1,2,3,4), 
         part %in% c('match_RDK')) %>%
  dplyr::select(subj_idx, acc_diff_so, rt_diff_os, difficulty) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty)) %>%
  tidyr::pivot_wider(
    names_from = difficulty,
    values_from = c(acc_diff_so, rt_diff_os),  # 同时处理acc和rt列
    names_glue = "{.value}_{difficulty}" ) 


# 输出到新的CSV文件
output_file <- base::file.path(output_path, "df_motion_diff_match.csv")
utils::write.csv(df_motion_diff_match, output_file, row.names = FALSE)
```

### 运动组-辨别任务

```{r}
df_motion_rdk <- data_motion_rt_acc %>% 
  dplyr::filter(# difficulty %in% c(1, 4), 
    part %in% c('RDK')) %>%
  dplyr::select(subj_idx, acc, rt, association, difficulty, group) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         association = as.factor(association),
         difficulty = as.factor(difficulty))

# 输出到新的CSV文件
output_file <- base::file.path(output_path, "df_motion_rdk.csv")
utils::write.csv(df_motion_rdk, output_file, row.names = FALSE)

df_motion_diff_rdk <- data_motion_diff %>%
  # 只选择难度为1 和 4 的
  dplyr::filter(difficulty %in% c(1, 2, 3, 4), part %in% c('RDK')) %>%
  dplyr::select(subj_idx, acc_diff_so, rt_diff_os, difficulty) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty)) %>%
  tidyr::pivot_wider(
    names_from = difficulty,
    values_from = c(acc_diff_so, rt_diff_os),  # 同时处理acc和rt列
    names_glue = "{.value}_{difficulty}" ) 


# 输出到新的CSV文件
output_file <- base::file.path(output_path, "df_motion_diff_rdk.csv")
utils::write.csv(df_motion_diff_rdk, output_file, row.names = FALSE)
```

### 颜色组-匹配任务

```{r}
df_color_match <- data_color_rt_acc %>% 
  dplyr::filter(# difficulty %in% c(1, 4), 
    part %in% c('match_RDK')) %>%
  dplyr::select(subj_idx, acc, rt, association, difficulty, isMatch, group) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         association = as.factor(association),
         difficulty = as.factor(difficulty))

df_color_match_matchTrial <- data_color_rt_acc %>% 
  dplyr::filter(isMatch %in% c('match'), 
    part %in% c('match_RDK')) %>%
  dplyr::select(subj_idx, acc, rt, association, difficulty, isMatch, group) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         association = as.factor(association),
         difficulty = as.factor(difficulty))

df_color_match_nonmatchTrial <- data_color_rt_acc %>% 
  dplyr::filter(isMatch %in% c('mismatch'), 
    part %in% c('match_RDK')) %>%
  dplyr::select(subj_idx, acc, rt, association, difficulty, isMatch, group) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         association = as.factor(association),
         difficulty = as.factor(difficulty))

# 输出到新的CSV文件
output_file <- base::file.path(output_path, "df_color_match.csv")
utils::write.csv(df_color_match, output_file, row.names = FALSE)

df_color_diff_match <- data_color_diff %>%
  # 只选择难度为1 和 4 的
  dplyr::filter(difficulty %in% c(1, 2, 3, 4),
         part %in% c('match_RDK')) %>%
  dplyr::select(subj_idx, acc_diff_so, rt_diff_os, difficulty) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty)) %>%
  tidyr::pivot_wider(
    names_from = difficulty,
    values_from = c(acc_diff_so, rt_diff_os),  # 同时处理acc和rt列
    names_glue = "{.value}_{difficulty}" ) 

df_color_diff_match_matchTrial <- data_color_diff_keepMatch %>%
  # 选出匹配试次
  dplyr::filter(isMatch %in% c('match'), 
         part %in% c('match_RDK')) %>%
  dplyr::select(subj_idx, acc_diff_so, rt_diff_os, difficulty) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty)) %>%
  tidyr::pivot_wider(
    names_from = difficulty,
    values_from = c(acc_diff_so, rt_diff_os),  # 同时处理acc和rt列
    names_glue = "{.value}_{difficulty}" ) 

df_color_diff_match_nonmatchTrial <- data_color_diff_keepMatch %>%
  # 选出不匹配试次
  dplyr::filter(isMatch %in% c('mismatch'), 
         part %in% c('match_RDK')) %>%
  dplyr::select(subj_idx, acc_diff_so, rt_diff_os, difficulty) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty)) %>%
  tidyr::pivot_wider(
    names_from = difficulty,
    values_from = c(acc_diff_so, rt_diff_os),  # 同时处理acc和rt列
    names_glue = "{.value}_{difficulty}" ) 


# 输出到新的CSV文件
output_file <- base::file.path(output_path, "df_color_diff_match.csv")
utils::write.csv(df_color_diff_match, output_file, row.names = FALSE)
```

### 颜色组-辨别任务

```{r}
df_color_rdk <- data_color_rt_acc %>% 
  dplyr::filter(# difficulty %in% c(1, 4), 
    part %in% c('RDK')) %>%
  dplyr::select(subj_idx, acc, rt, association, difficulty, group) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         association = as.factor(association),
         difficulty = as.factor(difficulty))

# 输出到新的CSV文件
output_file <- base::file.path(output_path, "df_color_rdk.csv")
utils::write.csv(df_color_rdk, output_file, row.names = FALSE)

df_color_diff_rdk <- data_color_diff %>%
  # 只选择难度为1 和 4 的
  dplyr::filter(difficulty %in% c(1, 2, 3, 4), part %in% c('RDK')) %>%
  dplyr::select(subj_idx, acc_diff_so, rt_diff_os, difficulty) %>%
  #类型为character的转换为因子类型，便于后续分析
  dplyr::mutate(subj_idx = as.factor(subj_idx),
         difficulty = as.factor(difficulty)) %>%
  tidyr::pivot_wider(
    names_from = difficulty,
    values_from = c(acc_diff_so, rt_diff_os),  # 同时处理acc和rt列
    names_glue = "{.value}_{difficulty}" ) 


# 输出到新的CSV文件
output_file <- base::file.path(output_path, "df_color_diff_rdk.csv")
utils::write.csv(df_color_diff_rdk, output_file, row.names = FALSE)
```

## BF 值计算

**定义函数,用来计算所关注效应的 BF 值与绘图**

```{r}
bf_aov <- function(data, dv='acc', v='association') {
  set.seed(1234)
  
  subj_num <- base::unique(data$subj_idx) # 每个被试的编号
  n <- base::length(unique(data$subj_idx)) # 获取被试数量
  
  bfs_int <- base::rep(1, length(subj_num))
  bfs_a <- base::rep(1, length(subj_num))
  bfs_diff <- base::rep(1, length(subj_num))
  
  for (i in base::seq_along(subj_num)) {
    if (i == 1) {
      next # 由于一个被试不能正确计算贝叶斯因子，所以当i等于1时，跳过
    }
    # 使用dv参数构建公式
    dv_formula <- stats::as.formula(base::paste(dv, "~ 1 + subj_idx + difficulty:subj_idx +", v, ":subj_idx"))
    
    # 零模型
    null_model <- BayesFactor::lmBF(
      dv_formula,
      data = data,
      whichRandom = "subj_idx",
      rscaleFixed = 0.5,
      rscaleRandom = 1,
      iteration = 10000
    )
    
    # 仅包含 difficulty 主效应
    model_difficulty <- BayesFactor::lmBF(
      update(dv_formula, paste(". ~ . + difficulty")),
      data = data,
      whichRandom = "subj_idx",
      rscaleFixed = 0.5,
      rscaleRandom = 1,
      iteration = 10000
    )
    
    # 仅包含 v 主效应
    model_association <- BayesFactor::lmBF(
      update(dv_formula, paste(". ~ . +", v)),
      data = data,
      whichRandom = "subj_idx",
      rscaleFixed = 0.5,
      rscaleRandom = 1,
      iteration = 10000
    )
    
    # 包含两个主效应
    model_main <- BayesFactor::lmBF(
      update(dv_formula, paste(". ~ . + difficulty +", v)),
      data = data,
      whichRandom = "subj_idx",
      rscaleFixed = 0.5,
      rscaleRandom = 1,
      iteration = 10000
    )
    
    # 包含主效应和交互作用
    model_int <- BayesFactor::lmBF(
      update(dv_formula, paste(". ~ . + difficulty *", v)),
      data = data,
      whichRandom = "subj_idx",
      rscaleFixed = 0.5,
      rscaleRandom = 1,
      iteration = 10000
    )
    
    bfs_int[i] <- model_int / model_main
    bfs_a[i] <- model_main / model_difficulty
    bfs_diff[i] <- model_main / model_association
  }
  
  aov_output <- tibble::tibble(
    bfs_a = bfs_a,
    bfs_diff = bfs_diff,
    bfs_int = bfs_int
  )
  
  print(aov_output)
  return(aov_output)
}
```

```{r}
# 定义函数，用来对交互效应进行进一步检验
# 计算 bf 值，用贝叶斯配对样本t检验进一步检验交互作用
bf_pairwise_tests <- function(data, prefix = "acc_diff_so_") {
  
  set.seed(1234)
  pairs <- utils::combn(1:4, 2, simplify = FALSE)
  subj_num <- base::unique(data$subj_idx)
  
  # 创建嵌套列表存储所有结果
  all_results <- list()
  for (i in base::seq_along(subj_num)) { # i遍历subj_num
  if (i == 1) {
    next
  }
    current_subj <- base::unique(data$subj_idx)[1:i]
    df_sub <- data[data$subj_idx %in% current_subj, ]
    
    # 存储当前迭代的结果
    iter_results <- list()
    
    for (pair in pairs) {
      col1 <- base::paste0(prefix, pair[1])
      col2 <- base::paste0(prefix, pair[2])
      x <- df_sub[[col1]]
      y <- df_sub[[col2]]
      
      # 进行贝叶斯检验
      bf <- BayesFactor::ttestBF(x, y, paired = TRUE, nullInterval = c(0, Inf))
      
      iter_results[[base::paste(pair[1], "vs", pair[2])]] <- list(
        BF = exp(bf@bayesFactor$bf[1]),
        Direction = mean(x - y)
      )
    }
    all_results[[base::paste0("", i)]] <- iter_results
  }
  return(all_results)
}
```

```{r}
# 绘图函数，用来绘制主效应的图
plot_aov <- function(aov_output, dv, condition) {
  
  data_plot <- aov_output %>% 
  dplyr::mutate(n = 1:nrow(.)) %>% 
  tidyr::pivot_longer(bfs_a:bfs_int, names_to = "Effect", 
                      values_to = "Bayes_Factor") %>% 
  dplyr::mutate(dplyr::across(where(is.double), 
                              ~round(.x, digits = 2)))
  
  plot_obj <- data_plot %>% 
    dplyr::filter(Effect == dv ) %>% 
    ggplot2::ggplot(aes(x = n, y = Bayes_Factor)) + 
    geom_point(size = 3) + 
    geom_line() + 
    geom_hline(aes(yintercept = log(1)), linetype = "dashed") +
    geom_hline(aes(yintercept = log(10)), linetype = "dashed") +
    labs(y = TeX("$\\BF_{10}$")) + 
    ggtitle(paste(condition)) +  
    theme(
      panel.background = element_blank(),
      plot.margin = unit(c(1, 1, 1, 1), "cm"),
      plot.background = element_rect(fill = "white", color = NA),
      plot.title = element_text(size = 22, 
                                # family = "song",
                                face = "bold",
                                hjust = 0.5,
                                margin = margin(b = 15)),
      axis.line = element_line(color = "black", linewidth = .5),
      axis.title = element_text(size = 18, color = "black",
                                face = "bold"),
      axis.text = element_text(size = 15, color = "black"),
      axis.text.x = element_text(margin = margin(t = 10)),
      axis.title.y = element_text(margin = margin(r = 10)),
      axis.ticks = element_line(size = .5),
      panel.grid = element_blank(),
      legend.position.inside = c(0.20, 0.8),
      legend.background = element_rect(color = "black"),
      legend.text = element_text(size = 15),
      legend.margin = margin(t = 5, l = 5, r = 5, b = 5),
      legend.key = element_rect(color = NA, fill = NA)
    )
  
  return(plot_obj)
}
```

```{r}
# 绘图函数，用来绘制t检验的图
plot_ttest <- function(data, dv, condition) {
  
  plot_obj <- data %>%
    dplyr::filter(Effect == dv ) %>% 
    ggplot2::ggplot(aes(x = subj_idx, y = BFs, group = 1)) + 
    geom_point(size = 3) + 
    geom_line() + 
    geom_hline(aes(yintercept = log(1)), linetype = "dashed") +
    geom_hline(aes(yintercept = log(10)), linetype = "dashed") +
    labs(y = TeX("$\\BF_{10}$"), x = 'n') + 
    ggtitle(paste(condition)) +  
    theme(
      panel.background = element_blank(),
      plot.margin = unit(c(1, 1, 1, 1), "cm"),
      plot.background = element_rect(fill = "white", color = NA),
      plot.title = element_text(size = 22, 
                                # family = "song",
                                face = "bold",
                                hjust = 0.5,
                                margin = margin(b = 15)),
      axis.line = element_line(color = "black", linewidth = .5),
      axis.title = element_text(size = 18, color = "black",
                                face = "bold"),
      axis.text = element_text(size = 15, color = "black"),
      axis.text.x = element_text(margin = margin(t = 10)),
      axis.title.y = element_text(margin = margin(r = 10)),
      axis.ticks = element_line(size = .5),
      panel.grid = element_blank(),
      legend.position.inside = c(0.20, 0.8),
      legend.background = element_rect(color = "black"),
      legend.text = element_text(size = 15),
      legend.margin = margin(t = 5, l = 5, r = 5, b = 5),
      legend.key = element_rect(color = NA, fill = NA)
    )
  
  return(plot_obj)
}
```

### 运动组

**先检查是否存在匹配类型与关联类型的交互作用**

ACC

```{r}
set.seed(1234)

# 零模型
null_model <- BayesFactor::lmBF(
  acc ~ 1 + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 仅包含 match 主效应
model_match <- BayesFactor::lmBF(
  acc ~ isMatch + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 仅包含 association 主效应
model_association <- BayesFactor::lmBF(
  acc ~ association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 包含两个主效应（match + association）
model_main <- BayesFactor::lmBF(
  acc ~ isMatch + association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 包含主效应和交互作用（isMatch * association）
model_int <- BayesFactor::lmBF(
  acc ~ isMatch * association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)
```

```{r}
# 计算BF值
bf_int <- model_int / model_main
bf_ass <- model_main / model_match
bf_match <- model_main / model_association

print(bf_int)
print(bf_ass)
print(bf_match)
```

RT

```{r}
set.seed(1234)

# 零模型
null_model <- BayesFactor::lmBF(
  rt ~ 1 + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 仅包含 match 主效应
model_match <- BayesFactor::lmBF(
  rt ~ isMatch + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 仅包含 association 主效应
model_association <- BayesFactor::lmBF(
  rt ~ association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 包含两个主效应（match + association）
model_main <- BayesFactor::lmBF(
  rt ~ isMatch + association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 包含主效应和交互作用（isMatch * association）
model_int <- BayesFactor::lmBF(
  rt ~ isMatch * association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_motion_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)
```

```{r}
# 计算BF值
bf_int <- model_int / model_main
bf_ass <- model_main / model_match
bf_match <- model_main / model_association

print(bf_int)
print(bf_ass)
print(bf_match)
```

结果显示：对于正确率，当前数据存在中等的证据支持不存在关联
类型的主效应(BF_match=0.25)。对于反应时，当前数据存在较弱的证据支持不存在关联
类型的主效应(BF_match=0.53)

#### 匹配任务

##### 关联类型主效应

###### ACC

```{r}
bfs_association_mm_acc <- bf_aov(df_motion_match, 'acc', 'association')
bfs_association_mm_acc
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_mm_acc, 'bfs_a', 'Association effect: motion match task(ACC)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_mm_acc, 'bfs_int', 'Interaction: motion match task(ACC)')
plot_bfs_int
```

###### RT

```{r}
bfs_association_mm_rt <- bf_aov(df_motion_match, 'rt')
bfs_association_mm_rt
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_mm_rt, 'bfs_a', 'Association effect: motion match task(RT)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_mm_rt, 'bfs_int', 'Interaction: motion match task(RT)')
plot_bfs_int
```

##### 关联类型和难度的交互效应

###### ACC

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_mm_acc <- bf_pairwise_tests(df_motion_diff_match, "acc_diff_so_")

# 提取BF值到数据框
bfs_int_diff_mm_acc <- do.call(rbind, lapply(names(bfs_int_diff_mm_acc), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_mm_acc[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_mm_acc[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_mm_acc[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_mm_acc
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_mm_acc, '1 vs 2', 'difficulty1 > difficulty2: motion match task(ACC)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_mm_acc, '1 vs 3', 'difficulty1 > difficulty3: motion match task(ACC)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_mm_acc, '1 vs 4', 'difficulty1 > difficulty4: motion match task(ACC)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_mm_acc, '2 vs 3', 'difficulty2 > difficulty3: motion match task(ACC)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_mm_acc, '2 vs 4', 'difficulty2 > difficulty4: motion match task(ACC)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_mm_acc, '3 vs 4', 'difficulty3 > difficulty4: motion match task(ACC)')
plot_bfs_3vs4
```

**查看数据的变化趋势**

```{r}
# 转为长数据
df_motion_diff_match_long <- df_motion_diff_match %>% 
  tidyr::pivot_longer(
    cols = starts_with(c("acc_diff_so", "rt_diff_os")),
    names_to = c(".value", "difficulty"),
    names_pattern = "^(acc_diff|rt_diff)_[^_]+_(\\d+)$",  # 简化正则表达式
    values_drop_na = TRUE
  )

ggplot(df_motion_diff_match_long, aes(x = difficulty, y = acc_diff, group = subj_idx)) +
  geom_line(alpha = 0.5) +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1) + labs(title = "Differences Between Self and Other Across Difficulty Levels(Motion match task ACC)") +
  papaja::theme_apa(base_size = 18, # base_family = "Times"
                    )
```

###### RT

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_mm_rt <- bf_pairwise_tests(df_motion_diff_match, "rt_diff_os_")

# 提取BF值到数据框
bfs_int_diff_mm_rt <- do.call(rbind, lapply(names(bfs_int_diff_mm_rt), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_mm_rt[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_mm_rt[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_mm_rt[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_mm_rt
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_mm_rt, '1 vs 2', 'difficulty1 > difficulty2: motion match task(RT)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_mm_rt, '1 vs 3', 'difficulty1 > difficulty3: motion match task(RT)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_mm_rt, '1 vs 4', 'difficulty1 > difficulty4: motion match task(RT)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_mm_rt, '2 vs 3', 'difficulty2 > difficulty3: motion match task(RT)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_mm_rt, '2 vs 4', 'difficulty2 > difficulty4: motion match task(RT)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_mm_rt, '3 vs 4', 'difficulty3 > difficulty4: motion match task(RT)')
plot_bfs_3vs4
```

**查看数据的变化趋势**

```{r}
ggplot(df_motion_diff_match_long, aes(x = difficulty, y = rt_diff, group = subj_idx)) +
  geom_line(alpha = 0.5) +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1) + labs(title = "Differences Between Self and Other Across Difficulty Levels(Motion match task RT)") +
  papaja::theme_apa(base_size = 18,# base_family = "Times"
                    )
```

#### 辨别任务

##### 关联类型主效应

###### ACC

```{r}
bfs_association_mr_acc <- bf_aov(df_motion_rdk, 'acc')
bfs_association_mr_acc
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_mr_acc, 'bfs_a', 'Association effect: motion rdk task(ACC)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_mr_acc, 'bfs_int', 'Interaction: motion rdk task(ACC)')
plot_bfs_int
```

###### RT

```{r}
bfs_association_mr_rt <- bf_aov(df_motion_rdk, 'rt')
bfs_association_mr_rt
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_mr_rt, 'bfs_a', 'Association effect: motion rdk task(RT)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_mr_rt, 'bfs_int', 'Interaction: motion rdk task(RT)')
plot_bfs_int
```

##### 关联类型和难度的交互效应

###### ACC

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_mr_acc <- bf_pairwise_tests(df_motion_diff_rdk, "acc_diff_so_")

# 提取BF值到数据框
bfs_int_diff_mr_acc <- do.call(rbind, lapply(names(bfs_int_diff_mr_acc), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_mr_acc[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_mr_acc[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_mr_acc[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_mr_acc
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_mr_acc, '1 vs 2', 'difficulty1 > difficulty2: motion rdk task(ACC)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_mr_acc, '1 vs 3', 'difficulty1 > difficulty3: motion rdk task(ACC)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_mr_acc, '1 vs 4', 'difficulty1 > difficulty4: motion rdk task(ACC)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_mr_acc, '2 vs 3', 'difficulty2 > difficulty3: motion rdk task(ACC)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_mr_acc, '2 vs 4', 'difficulty2 > difficulty4: motion rdk task(ACC)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_mr_acc, '3 vs 4', 'difficulty3 > difficulty4: motion rdk task(ACC)')
plot_bfs_3vs4
```

**查看数据的变化趋势**

```{r}
# 转为长数据
df_motion_diff_rdk_long <- df_motion_diff_rdk %>% 
  tidyr::pivot_longer(
    cols = starts_with(c("acc_diff_so", "rt_diff_os")),
    names_to = c(".value", "difficulty"),
    names_pattern = "^(acc_diff|rt_diff)_[^_]+_(\\d+)$",  # 简化正则表达式
    values_drop_na = TRUE
  )

ggplot(df_motion_diff_rdk_long, aes(x = difficulty, y = acc_diff, group = subj_idx)) +
  geom_line(alpha = 0.5) +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1) + labs(title = "Differences Between Self and Other Across Difficulty Levels(Motion rdk task ACC)") +
  papaja::theme_apa(base_size = 18, # base_family = "Times"
                    )
```

###### RT

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_mr_rt <- bf_pairwise_tests(df_motion_diff_match, "rt_diff_os_")

# 提取BF值到数据框
bfs_int_diff_mr_rt <- do.call(rbind, lapply(names(bfs_int_diff_mr_rt), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_mr_rt[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_mr_rt[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_mr_rt[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_mr_rt
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_mr_rt, '1 vs 2', 'difficulty1 > difficulty2: motion rdk task(RT)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_mr_rt, '1 vs 3', 'difficulty1 > difficulty3: motion rdk task(RT)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_mr_rt, '1 vs 4', 'difficulty1 > difficulty4: motion rdk task(RT)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_mr_rt, '2 vs 3', 'difficulty2 > difficulty3: motion rdk task(RT)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_mr_rt, '2 vs 4', 'difficulty2 > difficulty4: motion rdk task(RT)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_mr_rt, '3 vs 4', 'difficulty3 > difficulty4: motion rdk task(RT)')
plot_bfs_3vs4
```

**查看数据的变化趋势**

```{r}
ggplot(df_motion_diff_rdk_long, aes(x = difficulty, y = rt_diff, group = subj_idx)) +
  geom_line(alpha = 0.5) +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1) + labs(title = "Differences Between Self and Other Across Difficulty Levels(Motion rdk task RT)") +
  papaja::theme_apa(base_size = 18,# base_family = "Times"
                    )
```

#### 任务间比较

##### ACC

```{r}
bfs_task_diff_acc <- bf_aov(data_motion_diff, 'acc_diff_so', 'part')
bfs_task_diff_acc
```

```{r}
plot_bfs_task <- plot_aov(bfs_task_diff_acc , 'bfs_a', 'Task effect: motion (ACC)')
plot_bfs_task

plot_bfs_task_int <- plot_aov(bfs_task_diff_acc , 'bfs_int', 'Interaction: motion (ACC)')
plot_bfs_task_int
```

##### RT

```{r}
bfs_task_diff_rt <- bf_aov(data_motion_diff, 'rt_diff_os', 'part')
bfs_task_diff_rt
```

```{r}
plot_bfs_task <- plot_aov(bfs_task_diff_rt , 'bfs_a', 'Task effect: motion (RT)')
plot_bfs_task

plot_bfs_task_int <- plot_aov(bfs_task_diff_rt , 'bfs_int', 'Interaction: motion (RT)')
plot_bfs_task_int
```

### 颜色组

**先检查是否存在匹配类型与关联类型的交互作用**

ACC

```{r}
set.seed(1234)

# 零模型
null_model <- BayesFactor::lmBF(
  acc ~ 1 + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 仅包含 match 主效应
model_match <- BayesFactor::lmBF(
  acc ~ isMatch + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 仅包含 association 主效应
model_association <- BayesFactor::lmBF(
  acc ~ association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 包含两个主效应（match + association）
model_main <- BayesFactor::lmBF(
  acc ~ isMatch + association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 包含主效应和交互作用（isMatch * association）
model_int <- BayesFactor::lmBF(
  acc ~ isMatch * association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)
```

```{r}
# 计算BF值
bf_int <- model_int / model_main
bf_ass <- model_main / model_match
bf_match <- model_main / model_association

print(bf_int)
print(bf_ass)
print(bf_match)
```

RT

```{r}
set.seed(1234)

# 零模型
null_model <- BayesFactor::lmBF(
  rt ~ 1 + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 仅包含 match 主效应
model_match <- BayesFactor::lmBF(
  rt ~ isMatch + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 仅包含 association 主效应
model_association <- BayesFactor::lmBF(
  rt ~ association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 包含两个主效应（match + association）
model_main <- BayesFactor::lmBF(
  rt ~ isMatch + association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)

# 包含主效应和交互作用（isMatch * association）
model_int <- BayesFactor::lmBF(
  rt ~ isMatch + association + isMatch : association + subj_idx + isMatch:subj_idx + association:subj_idx,
  data = df_color_match,
  whichRandom = "subj_idx",
  rscaleFixed = 0.5,
  rscaleRandom = 1,
  iteration = 10000)
```

```{r}
# 计算BF值
bf_int <- model_int / model_main
bf_ass <- model_main / model_match
bf_match <- model_main / model_association

print(bf_int)
print(bf_ass)
print(bf_match)
```

结果显示：对于正确率，当前数据存在中等的证据支持不存在关联
类型的主效应(BF_match=0.27)。对于反应时，当前数据存在较弱的证据支持不存在关联
类型的主效应(BF_match=0.54),
存在中等程度的证据支持存在匹配类型与关联类型的交互作用(BF_int=9.08),因此在后续匹配任务下RT的分析中分匹配试次与不匹配试次分布检验。

#### 匹配任务

##### 关联类型主效应

###### ACC

```{r}
bfs_association_cm_acc <- bf_aov(df_color_match, 'acc', 'association')
bfs_association_cm_acc
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_cm_acc, 'bfs_a', 'Association effect: color match task(ACC)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_cm_acc, 'bfs_int', 'Interaction: color match task(ACC)')
plot_bfs_int
```

###### RT

####### 匹配试次

```{r}
bfs_association_cm_rt <- bf_aov(df_color_match_matchTrial, 'rt', 'association')
bfs_association_cm_rt
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_cm_rt, 'bfs_a', 'Association effect: color match trial(RT)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_cm_rt, 'bfs_int', 'Interaction: color match trial(RT)')
plot_bfs_int
```

####### 不匹配试次

```{r}
bfs_association_cnm_rt <- bf_aov(df_color_match_nonmatchTrial, 'rt', 'association')
bfs_association_cnm_rt
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_cnm_rt, 'bfs_a', 'Association effect: color nonmatch trial(RT)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_cnm_rt, 'bfs_int', 'Interaction: color nonmatch trial(RT)')
plot_bfs_int
```

##### 关联类型和难度的交互效应

###### ACC

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_cm_acc <- bf_pairwise_tests(df_color_diff_match, "acc_diff_so_")

# 提取BF值到数据框
bfs_int_diff_cm_acc <- do.call(rbind, lapply(names(bfs_int_diff_cm_acc), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_cm_acc[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_cm_acc[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_cm_acc[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_cm_acc
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_cm_acc, '1 vs 2', 'difficulty1 > difficulty2: color match task(ACC)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_cm_acc, '1 vs 3', 'difficulty1 > difficulty3: color match task(ACC)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_cm_acc, '1 vs 4', 'difficulty1 > difficulty4: color match task(ACC)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_cm_acc, '2 vs 3', 'difficulty2 > difficulty3: color match task(ACC)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_cm_acc, '2 vs 4', 'difficulty2 > difficulty4: color match task(ACC)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_cm_acc, '3 vs 4', 'difficulty3 > difficulty4: color match task(ACC)')
plot_bfs_3vs4
```

**查看数据的变化趋势**

```{r}
# 转为长数据
df_color_diff_match_long <- df_color_diff_match %>% 
  tidyr::pivot_longer(
    cols = starts_with(c("acc_diff_so", "rt_diff_os")),
    names_to = c(".value", "difficulty"),
    names_pattern = "^(acc_diff|rt_diff)_[^_]+_(\\d+)$",  # 简化正则表达式
    values_drop_na = TRUE
  )

ggplot(df_color_diff_match_long, aes(x = difficulty, y = acc_diff, group = subj_idx)) +
  geom_line(alpha = 0.5) +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1) + labs(title = "Differences Between Self and Other Across Difficulty Levels(Color match task ACC)") +
  papaja::theme_apa(base_size = 18, # base_family = "Times"
                    )
```

###### RT

####### 匹配试次

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_cm_rt <- bf_pairwise_tests(df_color_diff_match_matchTrial, "rt_diff_os_")

# 提取BF值到数据框
bfs_int_diff_cm_rt <- do.call(rbind, lapply(names(bfs_int_diff_cm_rt), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_cm_rt[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_cm_rt[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_cm_rt[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_cm_rt
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_cm_rt, '1 vs 2', 'difficulty1 > difficulty2: color match trial(RT)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_cm_rt, '1 vs 3', 'difficulty1 > difficulty3: color match trial(RT)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_cm_rt, '1 vs 4', 'difficulty1 > difficulty4: color match trial(RT)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_cm_rt, '2 vs 3', 'difficulty2 > difficulty3: color match trial(RT)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_cm_rt, '2 vs 4', 'difficulty2 > difficulty4: color match trial(RT)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_cm_rt, '3 vs 4', 'difficulty3 > difficulty4: color match trial(RT)')
plot_bfs_3vs4
```

####### 不匹配试次

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_cnm_rt <- bf_pairwise_tests(df_color_diff_match_nonmatchTrial, "rt_diff_os_")

# 提取BF值到数据框
bfs_int_diff_cnm_rt <- do.call(rbind, lapply(names(bfs_int_diff_cnm_rt), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_cnm_rt[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_cnm_rt[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_cnm_rt[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_cnm_rt
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_cnm_rt, '1 vs 2', 'difficulty1 > difficulty2: color nonmatch trial(RT)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_cnm_rt, '1 vs 3', 'difficulty1 > difficulty3: color nonmatch trial(RT)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_cnm_rt, '1 vs 4', 'difficulty1 > difficulty4: color nonmatch trial(RT)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_cnm_rt, '2 vs 3', 'difficulty2 > difficulty3: color nonmatch trial(RT)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_cnm_rt, '2 vs 4', 'difficulty2 > difficulty4: color nonmatch trial(RT)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_cnm_rt, '3 vs 4', 'difficulty3 > difficulty4: color nonmatch trial(RT)')
plot_bfs_3vs4
```

**查看数据的变化趋势**

```{r}
ggplot(df_color_diff_match_long, aes(x = difficulty, y = rt_diff, group = subj_idx)) +
  geom_line(alpha = 0.5) +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1) + labs(title = "Differences Between Self and Other Across Difficulty Levels(Color match task RT)") +
  papaja::theme_apa(base_size = 18,# base_family = "Times"
                    )
```

#### 辨别任务

##### 关联类型主效应

###### ACC

```{r}
bfs_association_cr_acc <- bf_aov(df_color_rdk, 'acc', 'association')
bfs_association_cr_acc
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_cr_acc, 'bfs_a', 'Association effect: color rdk task(ACC)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_cr_acc, 'bfs_int', 'Interaction: color rdk task(ACC)')
plot_bfs_int
```

###### RT

```{r}
bfs_association_cr_rt <- bf_aov(df_color_rdk, 'rt', 'association')
bfs_association_cr_rt
```

**可视化**

```{r}
plot_bfs_association <- plot_aov(bfs_association_cr_rt, 'bfs_a', 'Association effect: color rdk task(RT)')
plot_bfs_association

plot_bfs_int <- plot_aov(bfs_association_cr_rt, 'bfs_int', 'Interaction: color rdk task(RT)')
plot_bfs_int
```

##### 关联类型和难度的交互效应

###### ACC

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_cr_acc <-bf_pairwise_tests(df_color_diff_rdk, "acc_diff_so_")

# 提取BF值到数据框
bfs_int_diff_cr_acc <- do.call(rbind, lapply(names(bfs_int_diff_cr_acc), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_cr_acc[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_cr_acc[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_cr_acc[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_cr_acc
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_cr_acc, '1 vs 2', 'difficulty1 > difficulty2: color rdk task(ACC)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_cr_acc, '1 vs 3', 'difficulty1 > difficulty3: color rdk task(ACC)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_cr_acc, '1 vs 4', 'difficulty1 > difficulty4: color rdk task(ACC)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_cr_acc, '2 vs 3', 'difficulty2 > difficulty3: color rdk task(ACC)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_cr_acc, '2 vs 4', 'difficulty2 > difficulty4: color rdk task(ACC)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_cr_acc, '3 vs 4', 'difficulty3 > difficulty4: color rdk task(ACC)')
plot_bfs_3vs4
```

**查看数据的变化趋势**

```{r}
# 转为长数据
df_color_diff_rdk_long <- df_color_diff_rdk %>% 
  tidyr::pivot_longer(
    cols = starts_with(c("acc_diff_so", "rt_diff_os")),
    names_to = c(".value", "difficulty"),
    names_pattern = "^(acc_diff|rt_diff)_[^_]+_(\\d+)$",  # 简化正则表达式
    values_drop_na = TRUE
  )

ggplot(df_color_diff_rdk_long, aes(x = difficulty, y = acc_diff, group = subj_idx)) +
  geom_line(alpha = 0.5) +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1) + labs(title = "Differences Between Self and Other Across Difficulty Levels(Color rdk task ACC)") +
  papaja::theme_apa(base_size = 18, # base_family = "Times"
                    )
```

###### RT

```{r}
# 调用函数进行不同条件的两两比较
bfs_int_diff_cr_rt <- bf_pairwise_tests(df_color_diff_rdk, "rt_diff_os_")

# 提取BF值到数据框
bfs_int_diff_cr_rt <- do.call(rbind, lapply(names(bfs_int_diff_cr_rt), function(iter){
  do.call(rbind, lapply(names(bfs_int_diff_cr_rt[[iter]]), function(comparison){
    data.frame(
      subj_idx = iter,
      Effect = comparison,
      BFs = bfs_int_diff_cr_rt[[iter]][[comparison]]$BF,
      Direction = bfs_int_diff_cr_rt[[iter]][[comparison]]$Direction
    )
  }))
})) %>%
  mutate(subj_idx = as.numeric(subj_idx))

bfs_int_diff_cr_rt
```

**可视化**

```{r}
plot_bfs_1vs2 <-  
  plot_ttest(bfs_int_diff_cr_rt, '1 vs 2', 'difficulty1 > difficulty2: color rdk task(RT)')
plot_bfs_1vs2

plot_bfs_1vs3 <- 
  plot_ttest(bfs_int_diff_cr_rt, '1 vs 3', 'difficulty1 > difficulty3: color rdk task(RT)')
plot_bfs_1vs3

plot_bfs_1vs4 <-  
  plot_ttest(bfs_int_diff_cr_rt, '1 vs 4', 'difficulty1 > difficulty4: color rdk task(RT)')
plot_bfs_1vs4

plot_bfs_2vs3 <- 
  plot_ttest(bfs_int_diff_cr_rt, '2 vs 3', 'difficulty2 > difficulty3: color rdk task(RT)')
plot_bfs_2vs3

plot_bfs_2vs4 <-  
  plot_ttest(bfs_int_diff_cr_rt, '2 vs 4', 'difficulty2 > difficulty4: color rdk task(RT)')
plot_bfs_2vs4

plot_bfs_3vs4 <- 
  plot_ttest(bfs_int_diff_cr_rt, '3 vs 4', 'difficulty3 > difficulty4: color rdk task(RT)')
plot_bfs_3vs4
```

**查看数据的变化趋势**

```{r}
ggplot(df_color_diff_rdk_long, aes(x = difficulty, y = rt_diff, group = subj_idx)) +
  geom_line(alpha = 0.5) +
  stat_summary(aes(group = 1), fun = mean, geom = "line", color = "red", size = 1) + labs(title = "Differences Between Self and Other Across Difficulty Levels(Color rdk task RT)") +
  papaja::theme_apa(base_size = 18,# base_family = "Times"
                    )
```

#### 任务间比较

##### ACC

```{r}
bfs_task_diff_acc <- bf_aov(data_color_diff, 'acc_diff_so', 'part')
bfs_task_diff_acc
```

```{r}
plot_bfs_task <- plot_aov(bfs_task_diff_acc , 'bfs_a', 'Task effect: color (ACC)')
plot_bfs_task

plot_bfs_task_int <- plot_aov(bfs_task_diff_acc , 'bfs_int', 'Interaction: color (ACC)')
plot_bfs_task_int
```

##### RT

```{r}
bfs_task_diff_rt <- bf_aov(data_color_diff, 'rt_diff_os', 'part')
bfs_task_diff_rt
```

```{r}
plot_bfs_task <- plot_aov(bfs_task_diff_rt , 'bfs_a', 'Task effect: color (RT)')
plot_bfs_task

plot_bfs_task_int <- plot_aov(bfs_task_diff_rt , 'bfs_int', 'Interaction: color (RT)')
plot_bfs_task_int
```

**End**
